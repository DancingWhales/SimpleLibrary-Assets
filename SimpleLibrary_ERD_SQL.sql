-- MySQL Script generated by MySQL Workbench
-- Fri Jun 22 13:33:46 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema SimpleLibrary
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema SimpleLibrary
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `SimpleLibrary` DEFAULT CHARACTER SET utf8 ;
USE `SimpleLibrary` ;

-- -----------------------------------------------------
-- Table `SimpleLibrary`.`COMPANYS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`COMPANYS` (
  `COMPANY_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '회사 고유 번호',
  `NAME` VARCHAR(45) NOT NULL COMMENT '회사 이름',
  `CODE` VARCHAR(255) NULL COMMENT '사업자등록번호\n(0일 경우 일반 단체)',
  `IS_APPROVAL` TINYINT(1) NULL DEFAULT 0 COMMENT '0(=false): 미승인\n1(=true): 승인',
  `CREATED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '회사 생성일 (창립날짜X, 서비스 가입 날짜)',
  PRIMARY KEY (`COMPANY_ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`ACCOUNTS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`ACCOUNTS` (
  `ACCOUNT_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '사용자 고유번호',
  `ID` VARCHAR(45) NOT NULL COMMENT '계정 아이디',
  `PW` VARCHAR(45) NOT NULL COMMENT '계정 비밀번호',
  `NAME` VARCHAR(45) NOT NULL COMMENT '계정 이름',
  `IS_ADMIN` TINYINT(1) NULL DEFAULT 0 COMMENT '관리자 유무\n0(=false): 일반 사용자\n1(=true): 관리자',
  `IS_APPROVAL` TINYINT NOT NULL DEFAULT 0 COMMENT '사용사 승인 상태\n0: 가입, 미승인 (서비스 이용 불가)\n1: 가입, 승인 (서비스 이용 가능)\n2: 탈퇴 (서비스 이용 불가)',
  `COMPANY_ID` INT NOT NULL COMMENT '소속된 회사 고유 번호',
  `RENT_COUNT` INT UNSIGNED ZEROFILL NULL DEFAULT 0 COMMENT '도서 대출 수 (누적)',
  `CREATE_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '계정 생성일',
  PRIMARY KEY (`ACCOUNT_ID`, `COMPANY_ID`),
  INDEX `FK_COMPANY_ID_idx` (`COMPANY_ID` ASC),
  UNIQUE INDEX `ID_UNIQUE` (`ID` ASC),
  CONSTRAINT `FK_COMPANY_ID`
    FOREIGN KEY (`COMPANY_ID`)
    REFERENCES `SimpleLibrary`.`COMPANYS` (`COMPANY_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`CATEGORY_MAIN`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`CATEGORY_MAIN` (
  `CATEGORY_MAIN_CODE` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '메인 카테고리 고유번호',
  `NAME` VARCHAR(45) NOT NULL COMMENT '메인 카테고리 명',
  `CREATED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`CATEGORY_MAIN_CODE`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`CATEGORY_SUB`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`CATEGORY_SUB` (
  `CATEGORY_SUB_CODE` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '서브 카테고리 고유번호',
  `CATEGORY_MAIN_CODE` INT UNSIGNED NOT NULL COMMENT '소속된 메인 카테고리 코드',
  `NAME` VARCHAR(45) NOT NULL COMMENT '서브 카테고리 명',
  `CRATED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`CATEGORY_SUB_CODE`, `CATEGORY_MAIN_CODE`),
  INDEX `FK_CATEGORY_MAIN_CODE_idx` (`CATEGORY_MAIN_CODE` ASC),
  CONSTRAINT `FK_CATEGORY_MAIN_CODE`
    FOREIGN KEY (`CATEGORY_MAIN_CODE`)
    REFERENCES `SimpleLibrary`.`CATEGORY_MAIN` (`CATEGORY_MAIN_CODE`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`BOOKS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`BOOKS` (
  `BOOK_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '도서 고유 번호',
  `TITLE` VARCHAR(45) NOT NULL COMMENT '제목',
  `AUTHOR` VARCHAR(45) NOT NULL COMMENT '작가',
  `PUBLISER` VARCHAR(45) NOT NULL COMMENT '출판사',
  `PUBLISHED_AT` TIMESTAMP NOT NULL COMMENT '출판일',
  `CATEGORY_MAIN_ID` INT NOT NULL COMMENT '메인 카테고리',
  `CATEGORY_SUB_ID` INT NOT NULL COMMENT '서브 카테고리',
  `ISBN` VARCHAR(45) NULL COMMENT 'ISBN 코드',
  `CREATED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`BOOK_ID`, `CATEGORY_MAIN_ID`, `CATEGORY_SUB_ID`),
  INDEX `CATEGORY_SUB_ID_idx` (`CATEGORY_SUB_ID` ASC),
  INDEX `FK_CATEGORY_MAIN_ID_idx` (`CATEGORY_MAIN_ID` ASC),
  CONSTRAINT `FK_CATEGORY_MAIN_ID`
    FOREIGN KEY (`CATEGORY_MAIN_ID`)
    REFERENCES `SimpleLibrary`.`CATEGORY_MAIN` (`CATEGORY_MAIN_CODE`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `CATEGORY_SUB_ID`
    FOREIGN KEY (`CATEGORY_SUB_ID`)
    REFERENCES `SimpleLibrary`.`CATEGORY_SUB` (`CATEGORY_SUB_CODE`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`COLLECTION_BOOKS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`COLLECTION_BOOKS` (
  `COLLECTION_BOOKS_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '보유 도서 목록 고유 번호',
  `BOOK_ID` INT NOT NULL COMMENT '도서 고유번호',
  `COMPANY_ID` INT NOT NULL COMMENT '회사 고유번호',
  `PURCHASED_AT` TIMESTAMP NULL COMMENT '구입일',
  `IS_RENTAL` TINYINT(1) NULL COMMENT '현재 대출 상태\n0(=false): 미대출\n1(=true): 대출',
  `CREATED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`COLLECTION_BOOKS_ID`, `BOOK_ID`, `COMPANY_ID`),
  INDEX `FK_BOOK_ID_idx` (`BOOK_ID` ASC),
  INDEX `FK_COMPANY_ID_idx` (`COMPANY_ID` ASC),
  CONSTRAINT `FK_BOOK_ID`
    FOREIGN KEY (`BOOK_ID`)
    REFERENCES `SimpleLibrary`.`BOOKS` (`BOOK_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_COMPANY_ID`
    FOREIGN KEY (`COMPANY_ID`)
    REFERENCES `SimpleLibrary`.`COMPANYS` (`COMPANY_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`RENT_LIST`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`RENT_LIST` (
  `RENT_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `ACCOUNT_ID` INT NOT NULL COMMENT '대출한 사용자 고유번호',
  `BOOK_ID` INT NOT NULL COMMENT '대출된 도서 고유번호',
  `IS_RENT` TINYINT(1) NULL COMMENT '현재 대출 상태\n0(=false): 미대출\n1(=true): 대출',
  `RENTED_AT` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT '도서 대출 날짜',
  `RETURNED_AT` TIMESTAMP NULL COMMENT '도서 반납 날짜',
  PRIMARY KEY (`RENT_ID`, `BOOK_ID`, `ACCOUNT_ID`),
  INDEX `FK_RENTAL_USER_idx` (`ACCOUNT_ID` ASC),
  INDEX `FK_BOOK_ID_idx` (`BOOK_ID` ASC),
  CONSTRAINT `FK_ACCOUNT_ID`
    FOREIGN KEY (`ACCOUNT_ID`)
    REFERENCES `SimpleLibrary`.`ACCOUNTS` (`ACCOUNT_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_BOOK_ID`
    FOREIGN KEY (`BOOK_ID`)
    REFERENCES `SimpleLibrary`.`COLLECTION_BOOKS` (`COLLECTION_BOOKS_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`SEARCH_LIST`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`SEARCH_LIST` (
  `SEARCH_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `KEYWORD` VARCHAR(45) NOT NULL COMMENT '검색한 키워드',
  `ACCOUNT_ID` INT NOT NULL COMMENT '검색한 사용자 고유 번호',
  `SEARCHED_AT` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '검색일',
  PRIMARY KEY (`SEARCH_ID`, `ACCOUNT_ID`),
  INDEX `FK_ACCOUNT_ID_idx` (`ACCOUNT_ID` ASC),
  CONSTRAINT `FK_ACCOUNT_ID`
    FOREIGN KEY (`ACCOUNT_ID`)
    REFERENCES `SimpleLibrary`.`ACCOUNTS` (`ACCOUNT_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `SimpleLibrary`.`REQUEST_LIST`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `SimpleLibrary`.`REQUEST_LIST` (
  `REQUEST_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `ACCOUNT_ID` INT NULL COMMENT '요청한 사용자 고유번호\n(사용자의 요청 없이 도서 구매 가능하기 때문에 NULL 허용)',
  `COMPANY_ID` INT NOT NULL COMMENT '요청받아 구입한 회사 고유번호',
  `COLLECTION_BOOKS_ID` INT NULL COMMENT '요청받아 구매한 보유 도서 고유번호',
  `CREATED_AT` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`REQUEST_ID`, `COMPANY_ID`),
  INDEX `FK_COLLENTION_BOOKS_ID_idx` (`COLLECTION_BOOKS_ID` ASC),
  INDEX `FK_COMPANY_ID_idx` (`COMPANY_ID` ASC),
  INDEX `FK_ACCOUNT_ID_idx` (`ACCOUNT_ID` ASC),
  CONSTRAINT `FK_COLLENTION_BOOKS_ID`
    FOREIGN KEY (`COLLECTION_BOOKS_ID`)
    REFERENCES `SimpleLibrary`.`COLLECTION_BOOKS` (`COLLECTION_BOOKS_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_COMPANY_ID`
    FOREIGN KEY (`COMPANY_ID`)
    REFERENCES `SimpleLibrary`.`COMPANYS` (`COMPANY_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_ACCOUNT_ID`
    FOREIGN KEY (`ACCOUNT_ID`)
    REFERENCES `SimpleLibrary`.`ACCOUNTS` (`ACCOUNT_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
